

<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>
    <title>build a Webserver with a high-available, scalable environment - Kai&#39;s Journal</title>
<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Treek">
<meta name="description" content="735 AWS project - AnyGroupLLC
VPC design
Our VPC design...">
<meta name="keywords" content="">

    <meta charset="utf-8">
    <meta name="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="telephone=no" name="format-detection">
    <meta name="renderer" content="webkit">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/journal.css?88747594">

<script src="/js/loadCSS.js"></script>
<script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Material+Icons");
    (function (d) {
        var config = {
                kitId: 'dwg1tuc',
                scriptTimeout: 3000,
                async: true
            },
            h = d.documentElement, t = setTimeout(function () {
                h.className = h.className.replace(/\bwf-loading\b/g, "") + " wf-inactive";
            }, config.scriptTimeout), tk = d.createElement("script"), f = false,
            s = d.getElementsByTagName("script")[0], a;
        h.className += " wf-loading";
        tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
        tk.async = true;
        tk.onload = tk.onreadystatechange = function () {
            a = this.readyState;
            if (f || a && a != "complete" && a != "loaded") return;
            f = true;
            clearTimeout(t);
            try {
                Typekit.load(config)
            } catch (e) {
            }
        };
        s.parentNode.insertBefore(tk, s)
    })(document);
</script>
<noscript>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Lora|Montserrat|Anonymous+Pro:400|Material+Icons"/>
</noscript>
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
<div id="top"></div>
<div id="app">
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            <a class="a-block drawer-menu-item false" href="https://github.com/treekay">
                Home
            </a>
            
            <a class="a-block drawer-menu-item false" href="/archives">
                Archive
            </a>
            

            
            
            <a class="a-block drawer-menu-item false" href="/tags/index.html">
                Tags
            </a>
            

            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="/">
            Kai&#39;s Journal
        </a>
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="/">
        <div class="single-column-header-title">Kai&#39;s Journal</div>
        <div class="single-column-header-subtitle"></div>
    </a>
</div>
<div ref="sideContainer" class="side-container">
    <a class="a-block nav-head false" href="/">
        <div class="nav-title">
            Kai's<br>Journal
        </div>
        <div class="nav-subtitle">
            treek
        </div>
    </a>

    <div class="nav-link-list">
        
        <a class="a-block no-tint nav-link-item false" href="/archives">
            Archive
        </a>
        

        
        
        <a class="a-block nav-link-item false" href="/tags/index.html">
            Tags
        </a>
        

        
    </div>

    
    <div class="nav-footer">
        Proudly published with Hexo<br>
        
        Theme <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> by <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a><br>
        
        &copy; 2025 <a href="https://github.com/treekay">Kai&#39;s Journal</a>
    </div>
</div>
<div ref="extraContainer" class="extra-container">
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>

        
    </div>
</div>



<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper-text-only"
                 style="background-image: url('')">
                <div class="post-title">
                    build a Webserver with a high-available, scalable environment
                    <div class="post-meta">
                        <time datetime="2025-10-23T07:57:52.000Z" itemprop="datePublished">
                            2025-10-23 20:57
                        </time>&nbsp;
                        
    
                        
                        
                        <i class="material-icons" style="">label</i>
                        
                        <a href='/tags/AWS/'>AWS</a>, 
                        
                        <a href='/tags/UoA/'>UoA</a>
                        
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    <h1 id="aws-project---anygroupllc">735 AWS project - AnyGroupLLC</h1>
<h2 id="vpc-design">VPC design</h2>
<p>Our VPC design uses this CIDR block (10.0.0.0/16) and runs across two Availability Zones (us-east-1a, us-east-1b) for better availability.</p>
<p>Each AZ has one public subnet and three private subnets for the frontend, backend, and database. There is a internet gateway attached to this VPC, and a endpoint S3 gateway for private instance to access resource.</p>
<h3 id="subnets">Subnets</h3>
<p>The public subnets are used for the NAT instances and web-ALB,</p>
<p>while the private subnets are used for EC2 instances for web, app, and database services.</p>
<p>All these subnets are corresponding to our design schema for CIDR block setting.</p>
<h4 id="route-tables">Route tables</h4>
<p>The public route table directs traffic to the Internet Gateway for internet access, and route local traffic to other VPC resources.</p>
<p>The private route table AZ1 are used for private subnets in AZ1, routing traffic to the NAT instance’s network interface, and S3 Gateway Endpoint, so private instances can reach Amazon S3 resource through the AWS network instead of the internet. and also local traffic to other VPC resources.</p>
<p>The private route table AZ2 are used for private subnets in AZ2. The only difference with the private route table 1 is, the target of the NAT instance, having a different network interface id.</p>
<h3 id="security-groups">Security Groups</h3>
<p>The web-ALB group allows inbound HTTP from the internet.</p>
<p>The web group accepts HTTP traffic from the web-ALB group.</p>
<p>The app-ALB group receives traffic from the web group.</p>
<p>And the app group only accepts traffic from that app-ALB group.</p>
<p>The database group only accepts traffic from the app group.</p>
<p>The NAT group allows all other traffic from the VPC and SSH from my IP, so NAT instance can also act as a Bastion host.</p>
<h3 id="nacls">NACLs</h3>
<p>For Network ACLs, all inbound traffic was open for public subnets.</p>
<p>for private subnets, only traffic from VPC are allowed.</p>
<h2 id="nat-instances">NAT instances</h2>
<p>We used NAT instances instead of NAT Gateways to save cost, following the Cost Optimization pillar.</p>
<p>We run an ec2 instance and using SSH connecting to the instance, after setting the network forwarding, the instance can act as a NAT.</p>
<p>Also, the web security group needs to allow SSH traffic from NAT security group.</p>
<p>Each AZ has its own NAT instance, so NAT instance are put in public subnets, assigned with a public IP.</p>
<p>For private route tables in each AZ, they point to different network interfaces of NAT instances, therefore directing traffic from instance in private subnets, through NAT instance, to the internet.</p>
<h2 id="ec2">EC2</h2>
<p>We use EC2 instance to run the web server and app server,</p>
<p>here we choose the t3.micro instance for demonstrating,</p>
<p>in the production environment, we can change to t3.medium for web instance, and t3.xlarge for app instance. which would be more suitable for the CPU, and memory requirements.</p>
<p>For web instance, we choose the Linux system as required, and we set up a web server with userdata to install and start the web service. This web instance run in private subnet for frontend.</p>
<p>For app instance, we choose the Windows system as required, and also install and run the example service by userdata script. This app instance run in private subnet for backend.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*#!/bin/bash*</span><br><span class="line"></span><br><span class="line">dnf install -y httpd</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;OK - Web Server is Running&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line">*#Start the web server*</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> httpd</span><br><span class="line"></span><br><span class="line">systemctl start httpd</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;powershell&gt;</span><br><span class="line"><span class="comment"># 安装 IIS</span></span><br><span class="line"><span class="built_in">Install-WindowsFeature</span> <span class="literal">-name</span> Web<span class="literal">-Server</span> <span class="literal">-IncludeManagementTools</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建简单的 index 页面</span></span><br><span class="line"><span class="variable">$path</span> = <span class="string">&quot;C:\inetpub\wwwroot\index.html&quot;</span></span><br><span class="line"><span class="string">&quot;OK - Backend Server is Running&quot;</span> | <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="variable">$path</span> <span class="literal">-Encoding</span> utf8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 IIS</span></span><br><span class="line"><span class="built_in">Start-Service</span> W3SVC</span><br><span class="line"><span class="built_in">Set-Service</span> W3SVC <span class="literal">-StartupType</span> Automatic</span><br><span class="line">&lt;/powershell&gt;</span><br></pre></td></tr></table></figure>
<h2 id="amis">AMIs</h2>
<p>And after these two instance running well, we create image from these instance, preparing for the launch template for auto-scaling group for web and app layers.</p>
<h2 id="target-groups">Target Groups</h2>
<p>We create web target group and app target group for recording the instance from web and app ASG, and serving for their health check.</p>
<h2 id="application-load-balancers">Application Load Balancers</h2>
<p>For availability,</p>
<p>we create ALB for both web and app layers, the web-ALB assigned with public subnets, therefore providing the internet access.</p>
<p>Here we can use this web address to access our simple web page, which support our web server successfully running and the outside traffic can access to the web instance by the web-ALB.</p>
<p>And this web-ALB listens on port 80 HTTP, only healthy instance can serve for requests. The web-ALB will forward the request to the healthy instance in web target-group.</p>
<p>And the app-ALB is used for receiving requests from the web instances, then forwarding to app target-group.</p>
<h2 id="auto-scaling-groups">Auto-Scaling Groups</h2>
<p>For scalability,</p>
<p>We create auto-scaling group for both web and app layers.</p>
<p>Frontend-ASG connect to the web-ALB, using launch template for web instance and AMI created by the web server, and register instance to web target-group.</p>
<p>Backend-ASG connect to the app-ALB, using launch template for app instance and AMI created by the app server, and register instance to app target-group.</p>
<p>For reliability,</p>
<p>we enable health checking on ASG to support shutting down unhealthy instance and creating new instance automatically,</p>
<p>and also enable monitoring on each instance to check the their status.</p>
<p>Here we just set desired capacity as 1, minimum as 1, and maximum as 2 for demonstrating and saving budgets.</p>
<p>In production environment, we can adjust the capacity as we need.</p>

                </div>
            </div>
    
            <nav class="post-pagination">
    
    <a class="newer-posts" href="/2025/10/30/aws/cidr_calculate/">
        Previous post<br>CIDR calculate example
    </a>
    
    <span class="page-number"></span>
    
    <a class="older-posts" href="/2025/10/21/aws/aws_learner_lab_export_commands/">
        Next post<br>Commands for exporting resources on AWS Learner Lab
    </a>
    
</nav>

    
            


        </div>
    </div>
    <div class="single-column-footer">
    Proudly published with Hexo<br>
    
    Theme <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> by <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a><br>
    
    &copy; 2025 <a href="https://github.com/treekay">Kai&#39;s Journal</a>
</div>
</div>

</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"
        integrity="sha256-EGs9T1xMHdvM1geM8jPpoo8EZ1V1VRsmcJz8OByENLA=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
        integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.min.js"
        integrity="sha256-FtWfRI+thWlNz2sB3SJbwKx5PgMyKIVgwHCTwa3biXc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/smooth-scroll@14.2.1/dist/smooth-scroll.polyfills.min.js"
        integrity="sha256-CI4Gq5E0io1Pv0xM3qPM+NUIOhbIBvC3GiN1Y4KhXpw=" crossorigin="anonymous"></script>
<script src="/js/journal.js?61511728"></script>



</body>
</html>
